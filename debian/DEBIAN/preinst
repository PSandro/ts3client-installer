#!/bin/bash
arch=`uname -m`
echo $arch #Debug

if [ "$arch" == "x86_64" ]; then
    dirName="TeamSpeak3-Client-linux_amd64"
else
    dirName="TeamSpeak3-Client-linux_x86"
fi

versions=$(curl -sb -H "Accept: application/json" "https://teamspeak.com/versions/client.json")

version=$(echo $versions | jq -r ".linux.$arch.version")
checksum=$(echo $versions | jq -r ".linux.$arch.checksum")
mirror=$(echo $versions | jq -r ".linux.$arch.mirrors[\"teamspeak.com\"]")

echo $mirror #Debug

run="teamspeak3client.run"

cd /tmp
curl -o $run $mirror

bash $run
mkdir --parents /opt/
mv $dirName teamspeak3client #TODO: Check, if foldername ist really Teamspeak3-Client-linux_$arch in any case
mv teamspeak3client /opt/teamspeak3client
rm -f $run
