#!/bin/bash
arch=`uname -m`

if [ "$arch" == "x86_64" ]; then
    dirName="TeamSpeak3-Client-linux_amd64"
else
    dirName="TeamSpeak3-Client-linux_x86" #TODO: Check, if foldername ist really Teamspeak3-Client-linux_x86 or rather Teamspeak3-Client-linux_i386
fi

## Fetching latest Version ##
versions=$(curl -sb -H "Accept: application/json" "https://teamspeak.com/versions/client.json")
version=$(echo $versions | jq -r ".linux.$arch.version")
checksum=$(echo $versions | jq -r ".linux.$arch.checksum")
mirror=$(echo $versions | jq -r ".linux.$arch.mirrors[\"teamspeak.com\"]")

## Download ##
echo "Downloading TeamSpeak3 Client $version for architecture $arch"
run="teamspeak3client.run"
cd /tmp #enter temp dir
curl -o $run $mirror #download TeamSpeak3 Client from mirror
mkdir -p /opt/ #create /opt/ if not already exists
bash $run --target /opt/teamspeak3client #unpack TeamSpeak3 client
rm -f $run #remove temporary file
